#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdint.h>

#include "toeplitz.h"
#include "toeplitz2.h"

static uint8_t port_rss_key[] = {
 0x6d, 0x5a, 0x56, 0xda, 0x25, 0x5b, 0x0e, 0xc2,
 0x41, 0x67, 0x25, 0x3d, 0x43, 0xa3, 0x8f, 0xb0,
 0xd0, 0xca, 0x2b, 0xcb, 0xae, 0x7b, 0x30, 0xb4,
 0x77, 0xcb, 0x2d, 0xa3, 0x80, 0x30, 0xf2, 0x0c,
 0x6a, 0x42, 0xb7, 0x3b, 0xbe, 0xac, 0x01, 0xfa,

 0x6d, 0x5a, 0x56, 0xda, 0x25, 0x5b, 0x0e, 0xc2,
 0x41, 0x67, 0x25, 0x3d, 0x43, 0xa3, 0x8f, 0xb0,
 0xd0, 0xca, 0x2b, 0xcb, 0xae, 0x7b, 0x30, 0xb4,
 0x77, 0xcb, 0x2d, 0xa3, 0x80, 0x30, 0xf2, 0x0c,
 0x6a, 0x42, 0xb7, 0x3b, 0xbe, 0xac, 0x01, 0xfa,
};

int main()
{
	uint8_t *rss_key;

	/*
	 * See https://msdn.microsoft.com/en-us/library/windows/hardware/ff571021(v=vs.85).aspx
	 */
	rss_key = port_rss_key;
	toeplitz_init(rss_key,sizeof(port_rss_key));

	uint32_t src = 1107924411; /*ip addr converted to int*/
	uint32_t dst = 2710463568;
	uint16_t sport = 2794;
	uint16_t dport = 1766;	

	uint32_t hash = toeplitz_cpuhash_addrport(src,dst,sport,dport);
	if(hash != 0x51ccc178)
		printf("Hash order is not working: hash should be 0x%8.8X != 0x%8.8X\n",
			0x51ccc178,hash);
	else
		printf("Hash order is working: 0x%8.8X\n",hash);
}
